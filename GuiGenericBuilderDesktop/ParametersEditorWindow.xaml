<Window x:Class="GuiGenericBuilderDesktop.ParametersEditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:GuiGenericBuilderDesktop"
        Title="Edit Parameters" Height="400" Width="700">
    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock x:Name="FlagTitle" FontWeight="Bold" FontSize="14" />

        <DataGrid x:Name="ParamsGrid" Grid.Row="1" AutoGenerateColumns="False" CanUserAddRows="False" ItemsSource="{Binding}" RowEditEnding="ParamsGrid_RowEditEnding">

            <DataGrid.Resources>
                <DataTemplate x:Key="TextTemplate">
                    <TextBox Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                </DataTemplate>

                <DataTemplate x:Key="NumberTemplate">
                    <TextBox Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PreviewTextInput="NumberOnly_PreviewTextInput" />
                </DataTemplate>

                <local:ValueEditorTemplateSelector x:Key="ValueEditorSelector"
                                                   TextTemplate="{StaticResource TextTemplate}"
                                                   NumberTemplate="{StaticResource NumberTemplate}" />

            </DataGrid.Resources>

            <DataGrid.Columns>
                <!-- Name column: read-only display -->
                <DataGridTemplateColumn Header="Name" Width="2*" IsReadOnly="True">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- Value column: editing control type depends on Type -->
                <DataGridTemplateColumn Header="Value" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Value}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                    <DataGridTemplateColumn.CellEditingTemplate>
                        <DataTemplate>
                            <ContentControl Content="{Binding}" ContentTemplateSelector="{StaticResource ValueEditorSelector}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellEditingTemplate>
                </DataGridTemplateColumn>

            </DataGrid.Columns>

        </DataGrid>

        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
            <Button Content="OK" Width="80" Margin="4" Click="Ok_Click" />
            <Button Content="Cancel" Width="80" Margin="4" Click="Cancel_Click" />
        </StackPanel>
    </Grid>
</Window>
